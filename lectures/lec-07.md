# Лекція 07 Ландшафт кіберзагроз

## Вступ

Цифрова трансформація бізнесу створила безпрецедентні можливості для розвитку, але водночас відкрила нові вектори атак для зловмисників. Кожна автоматизована система, кожна інтеграція між сервісами, кожен процес, переведений у цифровий формат, потенційно створює вразливість, яку можуть експлуатувати атакувальники. За даними дослідження IBM Cost of Data Breach Report, середня вартість витоку даних у 2023 році сягнула 4.45 мільйона доларів США, а час виявлення та локалізації інциденту становить у середньому 277 днів.

Сучасний ландшафт загроз характеризується високим рівнем професіоналізації кіберзлочинності, появою організованих груп та навіть державних акторів. Атаки стають дедалі складнішими, використовуючи комбінації технічних вразливостей та методів соціальної інженерії. Ransomware перетворилося на прибутковий бізнес з моделлю Ransomware-as-a-Service, де розробники шкідливого ПЗ продають або здають в оренду свої інструменти іншим злочинцям.

У цій лекції ми систематично розглянемо основні типи кіберзагроз, з якими стикаються організації. Особливу увагу приділимо OWASP Top 10 - переліку найкритичніших вразливостей вебдодатків, який є стандартом індустрії. Вивчимо методи соціальної інженерії та інсайдерські загрози, оскільки людський фактор залишається найслабшою ланкою безпеки. Завершимо огляд актуальних трендів у кібербезпеці, щоб розуміти, як еволюціонують загрози та захисні механізми.

## Типи кібератак

### Malware - шкідливе програмне забезпечення

Malware (скорочення від malicious software) - це узагальнений термін для будь-якого програмного забезпечення, розробленого з метою завдати шкоди системі, викрасти дані або отримати несанкціонований доступ. Шкідливе ПЗ може поширюватися через заражені вкладення електронної пошти, зламані вебсайти, інфіковані USB накопичувачі, експлойти вразливостей у програмному забезпеченні.

Віруси - це програми, які копіюють себе, модифікуючи інші файли та вставляючи в них свій код. Вірус потребує дії користувача для активації, наприклад, запуску зараженого файлу. Після активації вірус може видаляти файли, викрадати дані, надавати віддалений доступ зловмисникам. Класичний приклад - макровіруси у документах Office, які виконують шкідливий код при відкритті документа.

Черв'яки відрізняються від вірусів здатністю самостійно поширюватися по мережі без участі користувача. Вони експлуатують вразливості мережевих сервісів для зараження інших систем. Історичні приклади включають черв'як WannaCry 2017 року, який використовував вразливість EternalBlue у протоколі SMB операційної системи Windows. Черв'як поширився по мережах організацій у понад 150 країнах, шифруючи файли та вимагаючи викуп.

Троянські програми маскуються під легітимне програмне забезпечення, але виконують шкідливі дії після встановлення. Назва походить від грецького міфу про троянського коня. Користувач добровільно встановлює програму, вважаючи її корисною, але насправді вона може викрадати паролі, встановлювати додаткове шкідливе ПЗ, надавати віддалений доступ до системи. Троянці часто поширюються через фальшиві оновлення програм, безкоштовні утиліти з ненадійних джерел.

Spyware таємно збирає інформацію про користувача та передає її третім особам. Це може бути історія браузера, натиснення клавіш (keylogging), скріншоти екрану, паролі та фінансова інформація. Комерційний spyware часто вбудовується у безкоштовні додатки для монетизації через продаж даних рекламним компаніям.

Adware відображає небажану рекламу, часто у вигляді спливаючих вікон. Хоча технічно не завжди шкідливий, adware сповільнює систему, порушує приватність, може перенаправляти браузер на шкідливі сайти.

Rootkit - особливо небезпечний тип malware, який отримує привілейований доступ до системи та приховує свою присутність. Rootkit може модифікувати операційну систему на низькому рівні, приховуючи процеси, файли, мережеві з'єднання від антивірусного ПЗ. Виявлення та видалення rootkit надзвичайно складне, часто вимагає повного переустановлення системи.

### Ransomware - шифрувальники-вимагачі

Ransomware стало однією з найнебезпечніших загроз останніх років. Це тип malware, який шифрує файли користувача або блокує доступ до системи, вимагаючи викуп за розшифрування. Зловмисники зазвичай вимагають оплату у криптовалюті (Bitcoin, Monero) для ускладнення відстеження.

Сучасний ransomware використовує стійке шифрування (AES-256, RSA-2048), яке практично неможливо зламати без ключа. Атака зазвичай відбувається у кілька етапів. Спочатку відбувається початкове зараження через фішингові листи, експлойти вразливостей, незахищені RDP (Remote Desktop Protocol) з'єднання. Потім виконується розвідка - malware вивчає мережу, ідентифікує цінні дані, знаходить резервні копії. Наступним кроком є ексфільтрація даних - перед шифруванням багато груп викрадають дані для подвійного вимагання. Потім відбувається шифрування файлів та видалення резервних копій. Завершується атака демонстрацією вимоги з інструкціями про оплату та погрозами.

Еволюція ransomware призвела до появи моделі Ransomware-as-a-Service (RaaS). Розробники створюють ransomware та надають його афіліатам за частку від викупу, зазвичай 20-30%. Афіліати здійснюють атаки, використовуючи готовий інструментарій. Ця модель знизила поріг входу для кіберзлочинців.

Подвійне вимагання стало новим стандартом. Зловмисники не лише шифрують дані, але й загрожують оприлюднити викрадену інформацію, якщо викуп не буде сплачений. Це особливо ефективно проти організацій з чутливими даними - медичні установи, юридичні фірми, фінансові інституції.

Відомі групи ransomware включають Conti, LockBit, BlackCat (ALPHV), REvil (припинила діяльність після арештів), DarkSide (атака на Colonial Pipeline 2021). Ці групи діють як організовані структури з технічною підтримкою жертв, переговорниками, навіть PR відділами.

Захист від ransomware вимагає багаторівневого підходу: регулярні резервні копії, зберігання офлайн або у незмінюваному сховищі, сегментація мережі для обмеження поширення, навчання персоналу розпізнавати фішинг, своєчасне оновлення програмного забезпечення, використання EDR (Endpoint Detection and Response) рішень, обмеження привілеїв користувачів, моніторинг незвичної активності файлової системи.

### Phishing - фішингові атаки

Phishing - це форма соціальної інженерії, де атакувальники видають себе за довірені організації для викрадення облікових даних, фінансової інформації або встановлення malware. Назва походить від fishing (рибалка) - зловмисники закидають "вудки" у надії, що хтось "клюне".

Класичний email phishing надсилає масові листи, що імітують повідомлення від банків, платіжних систем, популярних сервісів. Лист містить терміновий привід для дії: підозріла активність на рахунку, необхідність підтвердити особу, нібито виграш у лотереї. Посилання веде на фальшивий сайт, що виглядає ідентично до справжнього, де користувач вводить свої дані.

Приклад фішингового листа:

```
Від: security@paypa1.com (зверніть увагу на цифру 1 замість l)
Тема: Термінове повідомлення про безпеку вашого рахунку

Шановний користувач,

Ми виявили підозрілу активність на вашому рахунку PayPal.
Для захисту ваших коштів, будь ласка, підтвердіть свою особу,
натиснувши на посилання нижче протягом 24 годин.

[Підтвердити рахунок] → http://paypal-secure-verification.tk

Якщо ви не підтвердите свій рахунок, він буде тимчасово заблокований.

Команда безпеки PayPal
```

Ознаки фішингу включають підозрілу адресу відправника з незначними відмінностями від оригіналу, граматичні помилки та незграбні формулювання, терміновість та залякування, загальне звертання замість вашого імені, посилання з незвичними доменами, вкладення з виконуваними файлами.

Spear phishing - це цільові атаки на конкретних осіб або організації з використанням персоналізованої інформації. Атакувальники проводять ретельну розвідку через соціальні мережі, корпоративні вебсайти, витоки даних. Лист може згадувати реальні проєкти, колег, події, що робить його надзвичайно переконливим.

Whaling атакує керівників високого рівня (CEO, CFO), часто імітуючи бізнес-листування. Типовий сценарій - фальшивий лист від CEO до фінансового відділу з терміновим запитом на переказ коштів або надання конфіденційної інформації.

Vishing (voice phishing) використовує телефонні дзвінки. Зловмисник видає себе за представника банку, технічної підтримки, правоохоронних органів. Smishing (SMS phishing) надсилає фішингові повідомлення через SMS з посиланнями на шкідливі сайти або номерами преміум-тарифікації.

### DDoS - атаки на відмову в обслуговуванні

DDoS (Distributed Denial of Service) - це атака, мета якої зробити сервіс недоступним для легітимних користувачів шляхом перевантаження ресурсів. На відміну від DoS атаки з одного джерела, DDoS використовує тисячі або мільйони скомпрометованих пристроїв (ботнет) для одночасної атаки.

Типи DDoS атак включають volumetric attacks, які перевантажують канал зв'язку величезним обсягом трафіку, виміряним у гігабітах або терабітах на секунду. Protocol attacks експлуатують вразливості мережевих протоколів, виснажуючи ресурси мережевого обладнання. Application layer attacks цілять на вебдодатки, імітуючи легітимні запити для виснаження ресурсів сервера.

UDP flood надсилає величезну кількість UDP пакетів на випадкові порти сервера. Сервер перевіряє наявність програми на кожному порті та відправляє ICMP пакет про недоступність, витрачаючи ресурси.

SYN flood експлуатує процес встановлення TCP з'єднання (three-way handshake). Атакувальник надсилає величезну кількість SYN запитів з підробленими IP адресами. Сервер виділяє ресурси для кожного напівзавершеного з'єднання, очікуючи ACK відповіді, яка ніколи не прийде. Таблиця з'єднань переповнюється, і сервер не може приймати нові легітимні з'єднання.

HTTP flood надсилає велику кількість HTTP GET або POST запитів на ресурсомісткі сторінки вебсайту. Атака може бути складною для виявлення, оскільки запити виглядають легітимно. Slowloris тримає багато з'єднань до вебсервера відкритими якомога довше, періодично надсилаючи часткові HTTP заголовки. Сервер очікує завершення запитів, виснажуючи пул доступних з'єднань.

Amplification attacks використовують публічні сервери (DNS, NTP, Memcached) для посилення атаки. Атакувальник надсилає невеликий запит з підробленою IP адресою жертви. Сервер відправляє значно більшу відповідь жертві. Коефіцієнт посилення може досягати 1:100 або більше.

Захист від DDoS включає rate limiting для обмеження кількості запитів з одного джерела, використання CDN (Content Delivery Network) для розподілу навантаження та абсорбції атак, налаштування firewall для фільтрації аномального трафіку, спеціалізовані DDoS mitigation сервіси (Cloudflare, Akamai), налаштування мережевого обладнання для виявлення та блокування патернів атак, резервні канали зв'язку та географічно розподілені сервери.

### Man-in-the-Middle - атаки посередника

Man-in-the-Middle (MitM) - це атака, де зловмисник перехоплює та потенційно модифікує комунікацію між двома сторонами, які вважають, що спілкуються безпосередньо.

ARP spoofing в локальній мережі дозволяє атакувальнику асоціювати свою MAC адресу з IP адресою шлюзу або іншого пристрою. Трафік жертви проходить через пристрій атакувальника, який може читати та модифікувати дані перед пересиланням до призначення.

DNS spoofing підміняє IP адресу легітимного домену на адресу контрольованого атакувальником сервера. Користувач вводить справжню адресу сайту, але перенаправляється на фальшивий сайт. SSL stripping перетворює HTTPS з'єднання на HTTP. Коли користувач переходить на HTTPS сайт, атакувальник перехоплює початковий незашифрований запит та встановлює HTTPS з'єднання з сервером від свого імені, але надає жертві HTTP версію. Користувач не помічає відсутності HTTPS, а весь трафік проходить незашифрованим через атакувальника.

Атаки на публічні Wi-Fi мережі особливо небезпечні. Зловмисник створює фальшиву точку доступу з привабливою назвою (Free Airport WiFi, Starbucks Guest). Користувачі підключаються, і весь їх трафік проходить через пристрій атакувальника. Альтернативно, зловмисник може скомпрометувати легітимну публічну точку доступу.

Захист від MitM включає використання HTTPS для всіх чутливих операцій та перевірку валідності сертифікатів, VPN для шифрування трафіку в ненадійних мережах, HSTS (HTTP Strict Transport Security) заголовок, який змушує браузер завжди використовувати HTTPS, certificate pinning у мобільних додатках для перевірки конкретних сертифікатів, уникнення публічних Wi-Fi для фінансових операцій, перевірку адреси сайту перед введенням облікових даних.

## OWASP Top 10 - найпоширеніші вразливості вебдодатків

### Про OWASP та Top 10

OWASP (Open Web Application Security Project) - це міжнародна некомерційна організація, присвячена покращенню безпеки програмного забезпечення. OWASP Top 10 - це документ, що містить консенсус експертів щодо десяти найкритичніших ризиків безпеки вебдодатків. Останнє оновлення вийшло у 2021 році.

Top 10 не є вичерпним переліком всіх можливих вразливостей, але представляє найпоширеніші та найнебезпечніші проблеми, з якими стикаються організації. Розуміння цих вразливостей критично важливе для розробників, тестувальників безпеки та архітекторів систем.

### A01:2021 - Broken Access Control

Broken Access Control означає, що користувачі можуть діяти поза межами своїх дозволених повноважень. Це може дозволити несанкціонований доступ до даних, модифікацію даних інших користувачів, виконання функцій адміністратора.

Типові сценарії включають недостатню перевірку прав доступу. Додаток перевіряє автентифікацію (чи увійшов користувач), але не авторизацію (чи має він право на цю дію). Insecure Direct Object Reference (IDOR) дозволяє змінити параметр запиту для доступу до об'єктів інших користувачів:

```
https://bank.com/account?id=12345 (ваш рахунок)
https://bank.com/account?id=12346 (рахунок іншої особи - доступний!)
```

Privilege escalation означає, що звичайний користувач може отримати адміністративні права, наприклад, змінивши параметр у запиті:

```
POST /api/users/update
{
  "user_id": 123,
  "role": "admin"  // користувач сам призначає себе адміном
}
```

Missing Function Level Access Control виникає, коли адміністративні функції доступні всім, якщо знати URL:

```
https://app.com/admin/delete-user?id=456
// Доступно без перевірки прав адміністратора
```

Захист вимагає реалізації надійної моделі контролю доступу (RBAC, ABAC), перевірки прав на сервері для кожного запиту, використання принципу найменших привілеїв, логування спроб несанкціонованого доступу, тестування контролю доступу в автоматизованих та ручних тестах.

### A02:2021 - Cryptographic Failures

Cryptographic Failures (раніше Sensitive Data Exposure) стосується недостатнього захисту чутливих даних, таких як паролі, номери кредитних карток, персональна інформація, медичні дані.

Передача даних без шифрування означає використання HTTP замість HTTPS дозволяє перехоплення даних. Зберігання паролів у відкритому вигляді або з використанням слабких хеш-функцій (MD5, SHA1 без солі) робить їх легко відновлюваними. Використання застарілих алгоритмів шифрування (DES, RC4) є вразливим до сучасних атак. Відсутність або некоректне використання солі при хешуванні паролів дозволяє атаки через rainbow tables.

Слабкі ключі шифрування, недостатня довжина або передбачувана генерація робить шифрування неефективним. Експозиція чутливих даних через резервні копії, логи, повідомлення про помилки створює додаткові вектори атак.

Приклад небезпечного коду:

```python
# НЕБЕЗПЕЧНО - пароль зберігається у відкритому вигляді
user.password = request.form['password']
user.save()

# НЕБЕЗПЕЧНО - слабкий хеш без солі
import hashlib
user.password = hashlib.md5(password.encode()).hexdigest()
```

Правильний підхід:

```python
from werkzeug.security import generate_password_hash, check_password_hash

# Безпечне хешування з автоматичною сіллю
user.password = generate_password_hash(password, method='pbkdf2:sha256', salt_length=16)

# Перевірка пароля
if check_password_hash(user.password, submitted_password):
    login_user(user)
```

Захист вимагає класифікації даних за рівнем чутливості, шифрування даних при передачі (TLS 1.2+) та зберіганні, використання сучасних алгоритмів (AES-256, RSA-2048+), хешування паролів з використанням bcrypt, scrypt або Argon2, безпечного управління ключами шифрування, регулярного аудиту та оновлення криптографічних механізмів.

### A03:2021 - Injection

Injection атаки виникають, коли недовірені дані надсилаються інтерпретатору як частина команди або запиту. SQL Injection - найвідоміший тип, але існують також Command Injection, LDAP Injection, XML Injection.

SQL Injection дозволяє атакувальнику виконувати довільні SQL запити до бази даних. Розглянемо вразливий код:

```python
# НЕБЕЗПЕЧНО
username = request.form['username']
password = request.form['password']

query = f"SELECT * FROM users WHERE username='{username}' AND password='{password}'"
user = db.execute(query)
```

Атакувальник може ввести у поле username:

```
admin' OR '1'='1' --
```

Результуючий запит:

```sql
SELECT * FROM users WHERE username='admin' OR '1'='1' --' AND password=''
```

Частина після -- є коментарем і ігнорується. Умова '1'='1' завжди істинна, тому запит поверне всіх користувачів, і атакувальник отримає доступ як адміністратор.

Більш деструктивний приклад - видалення даних:

```
' OR 1=1; DROP TABLE users; --
```

Command Injection виникає при виконанні системних команд з недовіреними даними:

```python
# НЕБЕЗПЕЧНО
import os
filename = request.form['filename']
os.system(f"cat {filename}")
```

Атакувальник вводить:

```
file.txt; rm -rf /
```

Захист від Injection вимагає використання параметризованих запитів (prepared statements):

```python
# БЕЗПЕЧНО
cursor.execute(
    "SELECT * FROM users WHERE username=? AND password=?",
    (username, password)
)
```

Також потрібна валідація та санітизація вводу користувача, використання ORM frameworks (SQLAlchemy, Django ORM), уникнення виконання системних команд з користувацькими даними, принцип найменших привілеїв для облікових записів БД, використання Web Application Firewall (WAF) для виявлення атак.

### A04:2021 - Insecure Design

Insecure Design - це нова категорія у Top 10 2021, що фокусується на ризиках, пов'язаних з дизайном та архітектурою. На відміну від вразливостей реалізації, проблеми дизайну не можна виправити простим виправленням коду.

Приклади включають відсутність моделювання загроз на етапі проєктування, неправильні припущення про безпеку (наприклад, довіра до клієнтської валідації), відсутність обмежень швидкості запитів (rate limiting), що дозволяє brute-force атаки, проєктування без урахування принципу defense in depth.

Приклад проблеми дизайну - система відновлення пароля, яка надсилає новий пароль на email:

```python
def reset_password(email):
    new_password = generate_random_password()
    send_email(email, f"Ваш новий пароль: {new_password}")
    user.password = hash_password(new_password)
```

Проблеми: пароль передається незашифрованим email, користувач не контролює новий пароль, відсутнє підтвердження власника email, можливість атаки на чужі акаунти.

Безпечніший дизайн:

```python
def reset_password_request(email):
    token = generate_secure_token()
    store_token(email, token, expiry=datetime.now() + timedelta(hours=1))
    reset_url = f"https://site.com/reset?token={token}"
    send_email(email, f"Для скидання пароля перейдіть: {reset_url}")

def reset_password_confirm(token, new_password):
    email = validate_and_consume_token(token)
    if email:
        user = get_user(email)
        user.password = hash_password(new_password)
```

Захист вимагає інтеграції безпеки у весь життєвий цикл розробки (Secure SDLC), моделювання загроз для нових функцій та архітектурних рішень, використання безпечних патернів проєктування, peer review архітектурних рішень з фокусом на безпеку, використання перевірених бібліотек та фреймворків, принципу defense in depth - кілька рівнів захисту, тестування на проникнення на ранніх етапах.

### A05:2021 - Security Misconfiguration

Security Misconfiguration виникає через небезпечні налаштування за замовчуванням, неповну конфігурацію, відкриті хмарні сховища, неправильно налаштовані HTTP заголовки, детальні повідомлення про помилки, що розкривають чутливу інформацію.

Приклади включають default credentials - адміністративний доступ з паролем admin/admin, незахищені адміністративні панелі доступні публічно, directory listing увімкнений, показуючи структуру файлів, stack traces у повідомленнях про помилки розкривають технічні деталі, непотрібні сервіси та порти відкриті, застаріле програмне забезпечення без патчів безпеки.

Приклад небезпечної конфігурації вебсервера:

```apache
# НЕБЕЗПЕЧНО
<Directory /var/www/html>
    Options Indexes FollowSymLinks  # Дозволяє listing файлів
    AllowOverride All
    Require all granted  # Доступ для всіх
</Directory>
```

Безпечніша конфігурація:

```apache
<Directory /var/www/html>
    Options -Indexes +FollowSymLinks  # Вимкнути listing
    AllowOverride None
    Require all granted
</Directory>

# Приховати версію сервера
ServerTokens Prod
ServerSignature Off

# Захист від clickjacking
Header always append X-Frame-Options SAMEORIGIN

# XSS захист
Header set X-XSS-Protection "1; mode=block"
```

Захист вимагає автоматизованого процесу встановлення однакових конфігурацій у всіх середовищах, мінімальної платформи без зайвих функцій та сервісів, регулярного перегляду та оновлення конфігурацій, сегментації архітектури додатку, відправлення security headers (CSP, X-Frame-Options, HSTS), вимкнення детальних повідомлень про помилки у production, автоматизованої перевірки конфігурацій безпеки.

### A06:2021 - Vulnerable and Outdated Components

Використання компонентів з відомими вразливостями - поширена та небезпечна проблема. Сучасні додатки залежать від десятків або сотень зовнішніх бібліотек, фреймворків, компонентів. Якщо ці компоненти містять вразливості, весь додаток під ризиком.

Приклад - вразливість Log4Shell (CVE-2021-44228) у популярній Java бібліотеці Log4j дозволяла віддалене виконання коду. Мільйони додатків по всьому світу виявилися вразливими.

Ризики включають незнання версій використовуваних компонентів, відсутність моніторингу CVE (Common Vulnerabilities and Exposures) баз даних, використання компонентів з ненадійних джерел, застарілі залежності без підтримки, відсутність процесу регулярних оновлень.

Приклад вразливого package.json:

```json
{
  "dependencies": {
    "express": "3.0.0",  // Застаріла версія з вразливостями
    "lodash": "4.17.4",  // Вразливість prototype pollution
    "request": "2.88.0"  // Застарілий, більше не підтримується
  }
}
```

Захист вимагає інвентаризації всіх компонентів та їх версій, використання інструментів для моніторингу вразливостей (npm audit, Snyk, Dependabot), отримання компонентів лише з офіційних джерел, регулярних оновлень залежностей, видалення невикористовуваних залежностей, підписки на security alerts для критичних компонентів, автоматизованого сканування у CI/CD pipeline.

```bash
# Перевірка вразливостей у Node.js проєкті
npm audit

# Автоматичне виправлення
npm audit fix

# Перевірка в Python
pip-audit

# Використання Snyk
snyk test
snyk monitor
```

### A07:2021 - Identification and Authentication Failures

Проблеми автентифікації та управління сесіями дозволяють атакувальникам видавати себе за інших користувачів, отримувати несанкціонований доступ до облікових записів.

Типові вразливості включають weak passwords - дозвіл простих паролів (123456, password), відсутність захисту від brute-force атак, credential stuffing - використання викрадених пар логін/пароль з інших витоків, session fixation - можливість встановити передбачуваний session ID, insecure session management - відсутність тайм-аутів сесії, відсутність інвалідації сесії при логауті, missing multi-factor authentication для критичних операцій, експозиція session ID в URL.

Приклад небезпечного коду автентифікації:

```python
# НЕБЕЗПЕЧНО
def login(username, password):
    user = User.query.filter_by(username=username).first()
    if user and user.password == password:  # Пароль у відкритому вигляді
        session['user_id'] = user.id  # Без тайм-ауту
        return redirect('/dashboard')
    return "Invalid credentials"  # Розкриває, що існує такий username

# НЕБЕЗПЕЧНО - відсутність обмежень спроб
@app.route('/login', methods=['POST'])
def login():
    # Немає rate limiting - можливий brute-force
    username = request.form['username']
    password = request.form['password']
    # ... автентифікація
```

Безпечніша реалізація:

```python
from flask_limiter import Limiter
from werkzeug.security import check_password_hash
import pyotp

limiter = Limiter(app, key_func=lambda: request.remote_addr)

@app.route('/login', methods=['POST'])
@limiter.limit("5 per minute")  # Rate limiting
def login():
    username = request.form['username']
    password = request.form['password']

    user = User.query.filter_by(username=username).first()

    # Однакова відповідь для неіснуючого user та неправильного пароля
    if not user or not check_password_hash(user.password_hash, password):
        sleep(random.uniform(0.5, 1.5))  # Затримка проти timing attacks
        return "Invalid credentials", 401

    # MFA перевірка
    if user.mfa_enabled:
        if not verify_totp(user.mfa_secret, request.form.get('code')):
            return "Invalid MFA code", 401

    # Безпечна сесія
    session.permanent = True
    app.permanent_session_lifetime = timedelta(minutes=30)
    session['user_id'] = user.id
    session['created_at'] = datetime.now()

    return redirect('/dashboard')

def verify_totp(secret, code):
    totp = pyotp.TOTP(secret)
    return totp.verify(code, valid_window=1)
```

Захист вимагає реалізації MFA для всіх критичних операцій, надійної політики паролів (мінімальна довжина, складність), захисту від автоматизованих атак (CAPTCHA, rate limiting), безпечного управління сесіями з таймаутами, логування невдалих спроб автентифікації, використання proven authentication frameworks, перевірки на compromised passwords (HaveIBeenPwned API).

### A08:2021 - Software and Data Integrity Failures

Software and Data Integrity Failures стосуються коду та інфраструктури, що не захищені від порушення цілісності. Це включає використання бібліотек з ненадійних CDN, автоматичні оновлення без перевірки підпису, insecure deserialization, відсутність перевірки цілісності CI/CD pipeline.

Insecure deserialization дозволяє атакувальнику модифікувати серіалізовані об'єкти для виконання довільного коду. Приклад у Python:

```python
import pickle

# НЕБЕЗПЕЧНО
def load_user_data(data):
    return pickle.loads(data)  # Може виконати довільний код

# Атакувальник може створити шкідливий pickle об'єкт
malicious = pickle.dumps(MaliciousClass())
```

Supply chain attacks компрометують програмне забезпечення через ланцюг постачання. Атакувальники можуть підмінити легітимну бібліотеку на npm, PyPI, заразити build процес, скомпрометувати CDN.

Захист вимагає використання digital signatures для перевірки походження ПЗ та даних, dependency pinning - фіксація точних версій залежностей:

```json
{
  "dependencies": {
    "express": "4.18.2"  // Точна версія, не "^4.18.2"
  }
}
```

Також потрібна перевірка integrity hashes для CDN ресурсів:

```html
<script
  src="https://cdn.example.com/library.js"
  integrity="sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC"
  crossorigin="anonymous">
</script>
```

Використання захищеного CI/CD pipeline, перевірка коду перед merge, network segmentation для критичних систем, моніторинг несподіваних змін у файлах.

### A09:2021 - Security Logging and Monitoring Failures

Недостатнє логування та моніторинг унеможливлює виявлення, ескалацію та реагування на активні атаки. Багато витоків даних залишаються непоміченими місяцями через відсутність належного моніторингу.

Проблеми включають відсутність логування критичних подій (логін, зміна паролів, привілеїв), логи недоступні для аналізу або зберігаються локально на вразливих системах, відсутність alerting при підозрілій активності, неефективні процеси реагування на інциденти, логування чутливих даних (паролів, токенів).

Що потрібно логувати: всі спроби автентифікації (успішні та невдалі), зміни прав доступу та конфігурацій, спроби доступу до захищених ресурсів, валідаційні помилки та підозрілі дані вводу, системні помилки та exceptions, адміністративні операції.

Приклад правильного логування:

```python
import logging
from datetime import datetime

logger = logging.getLogger(__name__)

def login(username, password):
    user = User.query.filter_by(username=username).first()

    if not user or not check_password_hash(user.password_hash, password):
        logger.warning(
            "Failed login attempt",
            extra={
                "username": username,
                "ip_address": request.remote_addr,
                "user_agent": request.headers.get('User-Agent'),
                "timestamp": datetime.now().isoformat()
            }
        )
        return "Invalid credentials", 401

    logger.info(
        "Successful login",
        extra={
            "user_id": user.id,
            "username": username,
            "ip_address": request.remote_addr,
            "timestamp": datetime.now().isoformat()
        }
    )

    # Виявлення підозрілої активності
    if detect_anomaly(user.id, request.remote_addr):
        logger.critical(
            "Potential account takeover",
            extra={
                "user_id": user.id,
                "reason": "Login from unusual location/device"
            }
        )
        send_alert_to_security_team(user.id)
```

Захист вимагає централізованого збору логів (ELK Stack, Splunk, Graylog), захищеного зберігання логів з контролем доступу, автоматизованого аналізу для виявлення аномалій, real-time alerting при критичних подіях, регулярного review логів командою безпеки, визначених процедур incident response, дотримання retention policies та compliance вимог.

### A10:2021 - Server-Side Request Forgery (SSRF)

SSRF дозволяє атакувальнику змусити серверний додаток робити HTTP запити до довільних доменів, включаючи внутрішні ресурси, недоступні ззовні.

Приклад вразливого коду:

```python
import requests

# НЕБЕЗПЕЧНО
@app.route('/fetch')
def fetch_url():
    url = request.args.get('url')
    response = requests.get(url)  # Немає валідації
    return response.content
```

Атакувальник може запитати:

```
/fetch?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/
```

Це AWS metadata endpoint, який може розкрити credentials для доступу до хмарних ресурсів. Інші цілі включають внутрішні сервіси (http://internal-admin-panel:8080), сканування внутрішньої мережі, доступ до баз даних та інших сервісів, читання локальних файлів через file:// протокол.

Захист вимагає whitelist дозволених доменів або IP адрес:

```python
ALLOWED_DOMAINS = ['api.example.com', 'cdn.example.com']

def fetch_url(url):
    parsed = urlparse(url)

    if parsed.hostname not in ALLOWED_DOMAINS:
        raise ValueError("Domain not allowed")

    if parsed.hostname in ['localhost', '127.0.0.1', '169.254.169.254']:
        raise ValueError("Internal addresses not allowed")

    response = requests.get(url, timeout=5)
    return response.content
```

Також потрібна блокування приватних IP діапазонів, використання network segmentation, обмеження протоколів (дозволити лише HTTP/HTTPS), таймаути для запобігання DoS, логування всіх SSRF спроб.

## Соціальна інженерія

### Психологічні принципи соціальної інженерії

Соціальна інженерія експлуатує людську психологію замість технічних вразливостей. Атакувальники використовують фундаментальні психологічні принципи для маніпуляції жертвами.

Authority (авторитет) - люди схильні виконувати вказівки осіб, яких сприймають як авторитетні фігури. Атакувальник може видавати себе за керівника, IT адміністратора, представника влади. Дослідження Мілграма показало, що люди готові виконувати навіть сумнівні дії, якщо їх віддає авторитетна особа.

Urgency (терміновість) створює тиск часу, примушуючи жертву діяти швидко без критичного мислення. Фішингові листи часто містять фрази типу "Ваш акаунт буде заблокований через 24 години", "Термінова проблема з платіжною системою". У стресовій ситуації люди роблять помилки.

Scarcity (дефіцит) використовує страх упустити можливість. "Тільки сьогодні", "Останній шанс", "Обмежена кількість місць". Цей принцип ефективний у маркетингу та соціальній інженерії.

Familiarity (знайомість) - люди більше довіряють тим, хто здається знайомим. Атакувальники можуть згадувати спільних знайомих, події, використовувати внутрішній жаргон організації для створення довіри.

Reciprocity (взаємність) - коли хтось робить нам послугу, ми відчуваємо зобов'язання віддячити. Атакувальник може спочатку надати якусь інформацію або допомогу, а потім попросити щось натомість.

Likability (симпатія) - ми схильні виконувати прохання людей, які нам подобаються. Соціальні інженери розвивають навички швидкого встановлення контакту (rapport building).

### Техніки соціальної інженерії

Pretexting - створення вигаданого сценарію (pretextu) для отримання інформації. Атакувальник детально готує історію та роль. Приклад: дзвінок від "IT підтримки" з проблемою, яка вимагає "верифікації" облікових даних користувача.

```
Атакувальник: "Доброго дня, це Олексій з IT відділу. У нас виникла проблема
з вашим профілем у системі після оновлення. Щоб відновити доступ, мені
потрібно підтвердити ваш ID співробітника та тимчасово скинути пароль.
Це займе лише хвилину."

Жертва: "Ой, так, я помітив, що система працює повільно..."

Атакувальник: "Саме через це оновлення. Давайте швидко це виправимо,
інакше до кінця дня ви не зможете надсилати важливі документи."
```

Baiting залишає фізичний або цифровий "привад". Класичний приклад - USB накопичувач з написом "Конфіденційно: зарплати 2024" залишений на парковці компанії. Цікавість змушує співробітника підключити його до комп'ютера, активуючи malware.

Quid pro quo пропонує послугу в обмін на інформацію або доступ. Атакувальник дзвонить, представляючись технічною підтримкою, і пропонує "безкоштовну перевірку безпеки" або "оновлення антивірусу". У процесі "допомоги" отримує доступ до системи.

Tailgating (piggybacking) - фізичне проникнення, слідуючи за авторизованою особою через захищені двері. Атакувальник може нести коробки, удаючи співробітника, що переїжджає, або просто посміхнутися та попросити "придержати двері".

### Захист від соціальної інженерії

Навчання персоналу є найкритичнішим заходом. Співробітники повинні знати про існування загрози, типові сценарії атак, як розпізнати червоні прапорці, що робити при підозрілій активності.

Регулярні симуляції фішингових атак допомагають тримати персонал напоготові та виявляти вразливих співробітників для додаткового навчання. Компанії можуть використовувати сервіси типу KnowBe4, Cofense для автоматизованих кампаній.

Процедури верифікації мають бути стандартизовані. Будь-який запит на чутливу інформацію або дії має підтверджуватися через альтернативний канал. Якщо хтось телефонує з проханням скинути пароль, зателефонуйте назад на офіційний номер IT підтримки.

Принцип least privilege обмежує потенційну шкоду. Якщо співробітник не має доступу до критичних даних, соціальна інженерія проти нього менш корисна.

Фізична безпека включає бейджі для ідентифікації, відеонагляд, заборону пропускати незнайомців через захищені двері, політику clear desk для запобігання shoulder surfing.

## Insider Threats - внутрішні загрози

### Типи інсайдерів

Insider threat - це загроза від осіб, які мають легітимний доступ до систем організації: співробітники, підрядники, партнери, колишні працівники з незакритим доступом.

Malicious insiders свідомо завдають шкоди з різних мотивів: фінансова вигода (продаж даних конкурентам), помста (незадоволення роботою, звільнення), ідеологічні причини, шпіонаж (державні агенти).

Negligent insiders не мають злого наміру, але їх недбалість створює ризики: використання слабких паролів або їх розголошення, відкриття фішингових вкладень, порушення політик безпеки, випадкова втрата пристроїв з даними, неналежне зберігання документів.

Compromised insiders - співробітники, чиї облікові записи скомпрометовані зовнішніми атакувальниками через фішинг, malware, викрадення облікових даних.

### Ознаки інсайдерської активності

Поведінкові індикатори включають раптові зміни у поведінці або ставленні, фінансові труднощі, незадоволеність роботою або керівництвом, конфлікти з колегами, планування звільнення або перехід до конкурента.

Технічні індикатори включають доступ до даних поза межами обов'язків, копіювання великих обсягів даних, особливо перед звільненням, незвична активність у непрацюючий час, спроби обходу систем безпеки, використання неавторизованих пристроїв або програм, частий доступ до чутливих систем без ділової необхідності.

Приклад реального інциденту - співробітник Tesla викрав терабайти конфіденційних даних перед звільненням. Він копіював виробничі креслення, програмний код, фінансову інформацію на особисті пристрої. Компанія виявила це через аномальні обсяги передачі даних.

### Захист від інсайдерських загроз

User and Entity Behavior Analytics (UEBA) використовує machine learning для створення базової лінії нормальної поведінки користувачів та виявлення аномалій. Система може виявити, що користувач раптом почав копіювати файли, до яких ніколи не звертався.

Data Loss Prevention (DLP) контролює та блокує передачу чутливих даних. Система може виявити спробу надіслати email з номерами кредитних карток, копіювання файлів з грифом "Конфіденційно" на USB, завантаження корпоративних даних у особисті хмарні сховища.

Privileged Access Management (PAM) контролює доступ до критичних систем, вимагає додаткової автентифікації для адміністративних операцій, записує всі дії привілейованих користувачів, автоматично ротує паролі для адміністративних акаунтів.

Відділення обов'язків (segregation of duties) означає, що критичні операції вимагають участі кількох осіб. Наприклад, розробник не має доступу до production середовища, один співробітник не може ініціювати та схвалити фінансову транзакцію.

Процес офбордингу при звільненні має бути ретельним: негайне блокування доступу після оголошення звільнення, повернення всіх пристроїв та ключів доступу, переведення важливих даних та проєктів, підписання NDA та нагадування про зобов'язання конфіденційності, моніторинг активності у останній робочий день.

## Актуальні тренди в кібербезпеці

### Штучний інтелект в атаках та захисті

AI змінює ландшафт кібербезпеки з обох боків. Атакувальники використовують machine learning для автоматизації розвідки, створення переконливіших фішингових повідомлень, обходу систем виявлення, адаптації malware до середовища жертви.

Deepfake технології дозволяють створювати реалістичні відео та аудіо. У 2019 році CEO британської енергетичної компанії переказав 220 тисяч євро шахраям, які використали AI для імітації голосу CEO материнської компанії.

Adversarial machine learning атакує системи на основі AI, надсилаючи спеціально підготовлені дані, які обманюють модель. Наприклад, злегка модифіковане зображення дорожнього знаку може бути неправильно класифіковане автопілотом.

Захисники використовують AI для виявлення аномалій у великих обсягах даних, автоматизованого аналізу malware, прогнозування майбутніх атак на основі patterns, автоматизації реагування на інциденти.

### Zero Trust Architecture

Traditional perimeter security припускає, що все всередині мережі довірене, а зовні - ні. Але це не працює у світі з хмарними сервісами, віддаленою роботою, BYOD (Bring Your Own Device).

Zero Trust виходить з принципу "never trust, always verify". Ніякій сутності не довіряється автоматично, навіть всередині мережі. Кожен запит потребує автентифікації та авторизації. Доступ надається на основі принципу least privilege. Мережа сегментується для обмеження lateral movement. Постійний моніторинг та логування всіх активностей.

Реалізація Zero Trust включає micro-segmentation мережі, strong authentication для всіх доступів, continuous verification під час сесій, детальний контроль доступу на рівні даних, шифрування всього трафіку.

### Cloud Security та DevSecOps

Міграція у хмару створює нові виклики безпеки: shared responsibility model - розподіл відповідальності між провайдером та клієнтом, misconfiguration як основна причина витоків даних у хмарі, складність управління доступом у мультихмарних середовищах, потреба у спеціалізованих інструментах (CSPM, CWPP).

DevSecOps інтегрує безпеку у весь цикл розробки та розгортання. Security as Code означає автоматизовані перевірки безпеки у CI/CD pipeline, автоматизоване сканування контейнерів та dependencies, Infrastructure as Code з контролем версій та review, shift left - виявлення проблем на ранніх етапах.

### Ransomware-as-a-Service та організована кіберзлочинність

Кіберзлочинність стала високопрофесійною індустрією з спеціалізацією та поділом праці. Initial Access Brokers продають доступ до скомпрометованих мереж. Ransomware developers створюють та оновлюють шифрувальники. Affiliates виконують атаки, використовуючи готові інструменти. Negotiators ведуть переговори про викуп. Money launderers відмивають криптовалюту.

### Supply Chain Attacks

Атаки на ланцюг постачання набирають популярності, оскільки дозволяють скомпрометувати десятки або сотні організацій через одну вразливість. SolarWinds hack 2020 року скомпрометував оновлення програмного забезпечення, заразивши тисячі організацій, включаючи урядові установи.

Захист вимагає ретельної перевірки постачальників, використання Software Bill of Materials (SBOM), моніторингу цілісності постачальників, диверсифікації ланцюга постачання, строгого контролю оновлень у критичних системах.

### Quantum Computing та постквантова криптографія

Квантові комп'ютери потенційно можуть зламати сучасні алгоритми шифрування (RSA, ECC). NIST розробляє постквантові криптографічні стандарти, стійкі до атак квантових комп'ютерів. Організаціям потрібно планувати міграцію на нові алгоритми.

### Кібербезпека IoT та критичної інфраструктури

Proliferation of IoT devices створює величезну attack surface. Багато пристроїв мають слабку безпеку: default credentials, відсутність оновлень, незашифрований трафік. Атаки на критичну інфраструктуру (енергетика, водопостачання, транспорт) можуть мати катастрофічні наслідки.

## Висновки

Ландшафт кіберзагроз постійно еволюціонує. Атакувальники стають дедалі складнішими та організованішими, використовуючи комбінації технічних вразливостей та соціальної інженерії. Malware, ransomware, phishing, DDoS залишаються основними векторами атак, постійно адаптуючись для обходу захисту.

OWASP Top 10 надає структурований огляд найкритичніших вразливостей вебдодатків. Розуміння цих вразливостей критично важливе для розробників, які мають інтегрувати безпеку у процес розробки з перших етапів. Broken Access Control, Injection, Cryptographic Failures продовжують залишатися в топі через їх поширеність та серйозність наслідків.

Соціальна інженерія експлуатує найслабшу ланку - людський фактор. Жодні технічні заходи не захистять від співробітника, який добровільно надає доступ, вважаючи, що спілкується з довіреною особою. Навчання персоналу та створення культури безпеки є критично важливими.

Інсайдерські загрози вимагають балансу між безпекою та довірою. Надмірний контроль може демотивувати співробітників, але його відсутність створює ризики. UEBA, DLP, PAM допомагають виявляти аномальну активність без мікроменеджменту.

Актуальні тренди показують, що майбутнє кібербезпеки лежить у автоматизації з використанням AI, архітектурі Zero Trust, інтеграції безпеки у DevOps процеси. Організації мають бути готові до нових загроз, таких як квантові комп'ютери та складніші supply chain attacks.

Ефективна стратегія кібербезпеки вимагає багаторівневого підходу (defense in depth), проактивного моніторингу та реагування, постійного навчання та адаптації, інтеграції безпеки у бізнес-процеси з самого початку. Безпека не є одноразовим проєктом, а постійним процесом вдосконалення та адаптації до нових загроз.
